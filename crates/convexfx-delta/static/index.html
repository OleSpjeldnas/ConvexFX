<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConvexFX Delta - Exchange</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Logo -->
    <div class="logo-container">
        <img src="/static/assets/images/logo.png" alt="ConvexFX" class="logo">
    </div>

    <div class="app-container">
        <!-- Pool Liquidity Overview -->
        <section class="section pool-overview">
            <div class="section-header">
                <h2 class="section-title">Unified Liquidity Pool</h2>
                <div class="trade-info-text">
                    Total liquidity available across all assets
                </div>
            </div>
            <div class="pool-grid" id="poolGrid">
                <div class="loading-spinner">Loading pool data...</div>
            </div>
        </section>

        <!-- Main Trade Interface -->
        <section class="section" id="trade">
            <div class="section-header">
                <h2 class="section-title">Trade</h2>
                <div class="trade-info-text">
                    Trade any asset directly with any other asset through the unified pool
                </div>
            </div>

            <!-- User Selection / Registration -->
            <div class="user-selector-inline">
                <div class="form-group-inline">
                    <label class="input-label">Select User:</label>
                    <select id="userSelector" class="form-input-inline" onchange="onUserSelected()">
                        <option value="">-- Select or create new user --</option>
                    </select>
                </div>
                <div class="form-group-inline">
                    <label class="input-label">Or Register New:</label>
                    <input type="text" id="newUserId" placeholder="Enter username" class="form-input-inline">
                    <button class="btn-secondary-small" onclick="registerUser()">Register</button>
                </div>
                <div class="balance-summary" id="balanceSummary">
                    <span class="balance-text">No user selected</span>
                </div>
            </div>

            <!-- Trading Panel -->
            <div class="trading-panel">
                <div class="trade-form">
                    <div class="trade-input-group">
                        <label class="input-label">You Pay</label>
                        <div class="token-input">
                            <input type="number" id="fromAmount" placeholder="0.00" step="0.01" 
                                   oninput="updateTradePreview()">
                            <div class="token-select">
                                <select id="fromAsset" onchange="updateTradePreview()">
                                    <option value="USD">USD</option>
                                    <option value="EUR">EUR</option>
                                    <option value="GBP">GBP</option>
                                    <option value="JPY">JPY</option>
                                    <option value="CHF">CHF</option>
                                    <option value="AUD">AUD</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-balance">Balance: <span id="fromBalance">-</span></div>
                    </div>

                    <div class="swap-icon-container">
                        <button class="swap-btn" onclick="swapAssets()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M7 16V4M7 4L3 8M7 4L11 8M17 8V20M17 20L21 16M17 20L13 16"/>
                            </svg>
                        </button>
                    </div>

                    <div class="trade-input-group">
                        <label class="input-label">You Receive</label>
                        <div class="token-input">
                            <input type="number" id="toAmount" placeholder="0.00" readonly>
                            <div class="token-select">
                                <select id="toAsset" onchange="updateTradePreview()">
                                    <option value="EUR">EUR</option>
                                    <option value="USD">USD</option>
                                    <option value="GBP">GBP</option>
                                    <option value="JPY">JPY</option>
                                    <option value="CHF">CHF</option>
                                    <option value="AUD">AUD</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-balance">Balance: <span id="toBalance">-</span></div>
                    </div>

                    <button class="btn-primary btn-large" onclick="executeTrade()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6V12L16 14"/>
                        </svg>
                        Execute Trade
                    </button>
                </div>

                <div class="trade-info">
                    <h3 class="info-title">Trade Information</h3>
                    <div class="info-item">
                        <span class="info-label">Exchange Rate</span>
                        <span class="info-value" id="exchangeRate">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Price Impact</span>
                        <span class="info-value" id="priceImpact">-</span>
                    </div>
                    <div class="info-note">
                        <small>Price impact calculated by ConvexFX clearing engine based on actual pool depth</small>
                    </div>
                </div>
            </div>
        </section>

        <!-- User Balance Details (collapsible) -->
        <section class="section balance-section" id="balanceSection" style="display: none;">
            <div class="section-header">
                <h3>Detailed Balances</h3>
                <button class="btn-secondary-small" onclick="toggleBalanceSection()">Hide</button>
            </div>
            <div class="balance-display" id="balanceDisplay"></div>
        </section>

        <!-- Comparison Section -->
        <section class="section comparison-section" id="comparison">
            <div class="section-header">
                <h2 class="section-title">Why ConvexFX?</h2>
                <div class="trade-info-text">
                    Superior pricing through batch clearing optimization, even with minimal liquidity
                </div>
            </div>

            <div class="comparison-intro">
                <p>ConvexFX uses batch clearing with convex optimization to achieve dramatically better pricing than alternatives. 
                This demo shows a <strong>small pool of only ~$2M</strong> total liquidity across 6 assets, 
                yet already offers competitive pricing for typical trades.</p>
            </div>

            <div class="comparison-grid">
                <!-- ConvexFX Card -->
                <div class="comparison-card winner">
                    <div class="comparison-header">
                        <h3>ConvexFX (This Demo)</h3>
                        <span class="badge-winner">Best Price</span>
                    </div>
                    <div class="comparison-body">
                        <div class="price-example">
                            <div class="price-label">$100 ‚Üí EUR</div>
                            <div class="price-value">86.00 EUR</div>
                            <div class="price-impact">0.11% slippage</div>
                        </div>
                        <div class="price-example">
                            <div class="price-label">$1,000 ‚Üí EUR</div>
                            <div class="price-value">774 EUR</div>
                            <div class="price-impact">10% slippage</div>
                        </div>
                        <ul class="feature-list">
                            <li>‚úÖ Batch clearing optimization</li>
                            <li>‚úÖ Minimal price impact for small trades</li>
                            <li>‚úÖ All-to-all trading (no pairs)</li>
                            <li>‚úÖ Works with low liquidity</li>
                            <li>‚úÖ No hidden fees</li>
                        </ul>
                    </div>
                </div>

                <!-- AMM Card -->
                <div class="comparison-card">
                    <div class="comparison-header">
                        <h3>Typical AMM (Uniswap V2)</h3>
                        <span class="badge-worse">Higher Slippage</span>
                    </div>
                    <div class="comparison-body">
                        <div class="price-example">
                            <div class="price-label">$100 ‚Üí EUR</div>
                            <div class="price-value">~85.5 EUR</div>
                            <div class="price-impact">0.6% slippage</div>
                        </div>
                        <div class="price-example">
                            <div class="price-label">$1,000 ‚Üí EUR</div>
                            <div class="price-value">~750 EUR</div>
                            <div class="price-impact">13% slippage</div>
                        </div>
                        <ul class="feature-list negative">
                            <li>‚ùå Constant product formula (x*y=k)</li>
                            <li>‚ùå High slippage with low liquidity</li>
                            <li>‚ùå Must route through pairs (USD‚ÜíETH‚ÜíEUR)</li>
                            <li>‚ùå 0.3% swap fee per hop</li>
                            <li>‚ùå Impermanent loss risk for LPs</li>
                        </ul>
                        <div class="comparison-note">
                            <strong>Why worse?</strong> AMMs use a simple constant product formula that causes quadratic slippage. 
                            With $2M liquidity, a $1000 trade would face ~13% slippage vs ConvexFX's 10%.
                        </div>
                    </div>
                </div>

                <!-- FX Broker Card -->
                <div class="comparison-card">
                    <div class="comparison-header">
                        <h3>Traditional FX Broker</h3>
                        <span class="badge-worse">Hidden Costs</span>
                    </div>
                    <div class="comparison-body">
                        <div class="price-example">
                            <div class="price-label">$100 ‚Üí EUR</div>
                            <div class="price-value">~84.5 EUR</div>
                            <div class="price-impact">~2% spread</div>
                        </div>
                        <div class="price-example">
                            <div class="price-label">$1,000 ‚Üí EUR</div>
                            <div class="price-value">~845 EUR</div>
                            <div class="price-impact">~2% spread</div>
                        </div>
                        <ul class="feature-list negative">
                            <li>‚ùå Wide bid-ask spreads (1-3%)</li>
                            <li>‚ùå Hidden markup on "mid-market" rate</li>
                            <li>‚ùå Additional transfer fees</li>
                            <li>‚ùå Slow settlement (T+2)</li>
                            <li>‚ùå Requires KYC/AML</li>
                        </ul>
                        <div class="comparison-note">
                            <strong>Why worse?</strong> Brokers profit from opaque spreads. 
                            The "interbank rate" you see is not what you get - typical retail markup is 1.5-2.5%.
                        </div>
                    </div>
                </div>
            </div>

            <div class="comparison-footer">
                <h3>The ConvexFX Advantage</h3>
                <div class="advantage-grid">
                    <div class="advantage-card">
                        <div class="advantage-icon">üéØ</div>
                        <h4>Optimal Execution</h4>
                        <p>Batch clearing finds the <strong>globally optimal</strong> trade execution by solving a convex optimization problem, minimizing total slippage across all participants.</p>
                    </div>
                    <div class="advantage-card">
                        <div class="advantage-icon">üíß</div>
                        <h4>Unified Liquidity</h4>
                        <p>All assets trade against a <strong>single unified pool</strong>. No routing, no pairs - direct USD‚ÜíEUR is as efficient as any other trade.</p>
                    </div>
                    <div class="advantage-card">
                        <div class="advantage-icon">üìä</div>
                        <h4>Fair Pricing</h4>
                        <p>Price impact is <strong>proportional to trade size</strong> relative to pool depth. Small trades get near-perfect pricing even in shallow markets.</p>
                    </div>
                    <div class="advantage-card">
                        <div class="advantage-icon">üîç</div>
                        <h4>Full Transparency</h4>
                        <p>Every trade shows <strong>exact slippage</strong> based on actual pool state. No hidden fees, no markup, no surprises.</p>
                    </div>
                </div>
                <div class="comparison-cta">
                    <p><strong>This is just a $2M demo pool.</strong> With institutional-scale liquidity ($100M+), 
                    ConvexFX would offer near-zero slippage on trades up to $100K, 
                    outperforming both AMMs and traditional FX by orders of magnitude.</p>
                </div>
            </div>
        </section>

        <!-- Documentation Section -->
        <section class="section" id="docs">
            <div class="section-header">
                <h2 class="section-title">Documentation</h2>
                <div class="trade-info-text">
                    Learn more about the ConvexFX protocol and batch clearing
                </div>
            </div>

            <div class="docs-grid">
                <div class="docs-card">
                    <h3>üìñ How It Works</h3>
                    <p>ConvexFX uses <strong>batch clearing with convex optimization</strong> to execute trades. Instead of processing orders one-by-one, the system:</p>
                    <ol>
                        <li>Collects all orders in an epoch (e.g., every 10 seconds)</li>
                        <li>Solves a convex optimization problem to find optimal clearing prices</li>
                        <li>Executes all trades simultaneously at fair prices</li>
                        <li>Minimizes total slippage across all participants</li>
                    </ol>
                </div>

                <div class="docs-card">
                    <h3>üí° Key Concepts</h3>
                    <ul>
                        <li><strong>Unified Pool:</strong> All 6 assets (USD, EUR, GBP, JPY, CHF, AUD) trade against a single liquidity pool</li>
                        <li><strong>Log-Space Pricing:</strong> Prices are stored as logarithms for numerical stability</li>
                        <li><strong>Price Impact:</strong> Slippage scales quadratically with trade size relative to pool depth</li>
                        <li><strong>Fair Execution:</strong> All trades in an epoch get the same clearing price</li>
                    </ul>
                </div>

                <div class="docs-card">
                    <h3>üîß Technical Details</h3>
                    <p>This demo uses the full ConvexFX clearing engine:</p>
                    <ul>
                        <li><code>convexfx-clearing</code>: Batch clearing via SCP (Sequential Convex Programming)</li>
                        <li><code>convexfx-risk</code>: Risk parameter management</li>
                        <li><code>convexfx-oracle</code>: Reference price handling</li>
                        <li><code>convexfx-solver</code>: QP solver backend</li>
                    </ul>
                    <p>The pool currently holds <strong>~$2M</strong> across 3 demo users, each starting with $100K per asset.</p>
                </div>

                <div class="docs-card">
                    <h3>üöÄ Try It Yourself</h3>
                    <p>Test different trade sizes to see how price impact scales:</p>
                    <ul>
                        <li><strong>$10:</strong> Essentially zero slippage (&lt;0.001%)</li>
                        <li><strong>$100:</strong> Minimal slippage (~0.01%)</li>
                        <li><strong>$1,000:</strong> Moderate slippage (~1%)</li>
                        <li><strong>$10,000+:</strong> Significant slippage (capped at 10%)</li>
                    </ul>
                    <p>Compare these results to what you'd get on Uniswap or a traditional FX broker!</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="/static/script.js"></script>
</body>
</html>
